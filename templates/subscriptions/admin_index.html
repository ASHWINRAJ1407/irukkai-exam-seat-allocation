{% extends "base.html" %}
{% block title %}Subscription Admin - Exam Seat Allocation{% endblock %}
{% block content %}
<h1 class="page-title mb-3"><i class="bi bi-gem me-2"></i>Subscription Admin</h1>

<div class="mb-3">
    <a href="{{ url_for('subscriptions.admin_settings') }}" class="btn btn-sm btn-outline-primary"><i class="bi bi-bank me-1"></i>Payment settings</a>
</div>

<div class="row g-4">
    <div class="col-lg-6">
        <div class="card h-100">
            <div class="card-header"><i class="bi bi-hourglass-split me-2"></i>Pending payment submissions</div>
            <div class="card-body">
                {% if pending %}
                <div class="table-responsive">
                    <table class="table table-sm align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>User ID</th>
                                <th>Plan ID</th>
                                <th>Reference</th>
                                <th>Submitted at</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for s in pending %}
                            <tr>
                                <td>{{ s.user_id }}</td>
                                <td>{{ s.plan_id }}</td>
                                <td><code>{{ s.reference }}</code></td>
                                <td>{{ s.created_at }}</td>
                                <td>
                                    <form method="post" action="{{ url_for('subscriptions.admin_update_submission', submission_id=s.id) }}" class="d-flex flex-column gap-1">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                        <textarea name="admin_note" class="form-control form-control-sm mb-1" rows="1" placeholder="Note (optional)"></textarea>
                                        <div class="btn-group btn-group-sm">
                                            <button type="submit" name="action" value="approve" class="btn btn-success">Approve</button>
                                            <button type="submit" name="action" value="reject" class="btn btn-danger">Reject</button>
                                        </div>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted mb-0">No pending submissions.</p>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="card h-100 mb-3">
            <div class="card-header"><i class="bi bi-clock-history me-2"></i>Recent submissions</div>
            <div class="card-body">
                {% if recent %}
                <div class="table-responsive">
                    <table class="table table-sm align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>User</th>
                                <th>Plan</th>
                                <th>Status</th>
                                <th>Reference</th>
                                <th>Processed at</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for s in recent %}
                            <tr>
                                <td>{{ s.user_id }}</td>
                                <td>{{ s.plan_id }}</td>
                                <td>{{ s.status }}</td>
                                <td><code>{{ s.reference }}</code></td>
                                <td>{{ s.processed_at or '-' }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted mb-0">No recent submissions.</p>
                {% endif %}
            </div>
        </div>
        <div class="card h-100">
            <div class="card-header"><i class="bi bi-people me-2"></i>Recent subscriptions</div>
            <div class="card-body">
                {% if subscriptions %}
                <div class="table-responsive">
                    <table class="table table-sm align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>User</th>
                                <th>Plan</th>
                                <th>Start</th>
                                <th>End</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for sub in subscriptions %}
                            <tr>
                                <td>{{ sub.user_id }}</td>
                                <td>{{ sub.plan_id }}</td>
                                <td>{{ sub.start_date }}</td>
                                <td>{{ sub.end_date }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted mb-0">No subscriptions yet.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

